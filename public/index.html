<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4a6cf7">
    <meta name="description" content="MeinungsMeter - Bewerte Meinungen in Echtzeit">
    <title>Meinungsmeter - Login & Signup</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div class="container">
        <!-- Login Form -->
        <div id="loginForm" class="form-container active">
            <div class="form-box">
                <h1>Login</h1>
                <form id="loginFormElement">
                    <div class="form-group">
                        <label for="loginEmail">Email:</label>
                        <input type="email" id="loginEmail" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Passwort:</label>
                        <input type="password" id="loginPassword" name="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Login</button>
                    <div id="loginMessage" class="message"></div>
                </form>
                <p class="toggle-text">Noch kein Konto? <a href="#" onclick="toggleForms()">Hier registrieren</a></p>
                <p class="toggle-text" style="font-size: 13px;"><a href="#" onclick="showForgotPasswordModal(event)">Passwort vergessen?</a></p>
                <p class="admin-link" style="margin-top: 20px; text-align: center; font-size: 12px;"><a href="admin.html">Admin Konsole</a></p>
            </div>
        </div>

        <!-- Signup Form -->
        <div id="signupForm" class="form-container">
            <div class="form-box">
                <h1>Registrierung</h1>
                <form id="signupFormElement">
                    <div class="form-group">
                        <label for="signupUsername">Benutzername: <span class="required">*</span></label>
                        <input type="text" id="signupUsername" name="username" required>
                    </div>
                    <div class="form-group">
                        <label for="signupEmail">Email: <span class="required">*</span></label>
                        <input type="email" id="signupEmail" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="signupPassword">Passwort: <span class="required">*</span></label>
                        <input type="password" id="signupPassword" name="password" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Passwort wiederholen: <span class="required">*</span></label>
                        <input type="password" id="confirmPassword" name="confirmPassword" required>
                    </div>
                    
                    <div class="optional-section">
                        <p class="optional-label">Optionale Angaben:</p>
                        <div class="form-group">
                            <label for="signupAge">Alter:</label>
                            <input type="number" id="signupAge" name="age" min="1" max="150">
                        </div>
                        <div class="form-group">
                            <label for="signupState">Bundesland:</label>
                            <select id="signupState" name="state">
                                <option value="">-- W√§hlen Sie ein Bundesland --</option>
                                <option value="Baden-W√ºrttemberg">Baden-W√ºrttemberg</option>
                                <option value="Bayern">Bayern</option>
                                <option value="Berlin">Berlin</option>
                                <option value="Brandenburg">Brandenburg</option>
                                <option value="Bremen">Bremen</option>
                                <option value="Hamburg">Hamburg</option>
                                <option value="Hessen">Hessen</option>
                                <option value="Mecklenburg-Vorpommern">Mecklenburg-Vorpommern</option>
                                <option value="Niedersachsen">Niedersachsen</option>
                                <option value="Nordrhein-Westfalen">Nordrhein-Westfalen</option>
                                <option value="Rheinland-Pfalz">Rheinland-Pfalz</option>
                                <option value="Saarland">Saarland</option>
                                <option value="Sachsen">Sachsen</option>
                                <option value="Sachsen-Anhalt">Sachsen-Anhalt</option>
                                <option value="Schleswig-Holstein">Schleswig-Holstein</option>
                                <option value="Th√ºringen">Th√ºringen</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="signupProfession">Beruf:</label>
                            <input type="text" id="signupProfession" name="profession" placeholder="z.B. Softwareentwickler">
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Registrieren</button>
                    <div id="signupMessage" class="message"></div>
                </form>
                <p class="toggle-text">Bereits registriert? <a href="#" onclick="toggleForms()">Hier anmelden</a></p>
            </div>
        </div>

        <!-- Dashboard (nach erfolgreichem Login) -->
        <div id="dashboard" class="form-container dashboard-page">
            <header class="dashboard-header">
                <div class="banner">
                    <div class="banner-graphic" aria-hidden="true">
                        <svg viewBox="0 0 240 140" role="img" focusable="false">
                            <defs>
                                <linearGradient id="speedoGlow" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#5ee7df"/>
                                    <stop offset="100%" stop-color="#4a6cf7"/>
                                </linearGradient>
                            </defs>
                            <path d="M30 110a90 90 0 0 1 180 0" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="14"/>
                            <path d="M30 110a90 90 0 0 1 180 0" fill="none" stroke="url(#speedoGlow)" stroke-linecap="round" stroke-width="10" stroke-dasharray="420" stroke-dashoffset="90"/>
                            <circle cx="120" cy="110" r="10" fill="#fff"/>
                            <path d="M120 110 L170 60" stroke="#fff" stroke-width="6" stroke-linecap="round"/>
                            <circle cx="170" cy="60" r="6" fill="#fff"/>
                        </svg>
                    </div>
                    <div class="banner-text">
                        <p class="banner-kicker">Willkommen zur√ºck</p>
                        <h1>MeinungsMeter</h1>
                        <p class="banner-sub">Bewerte Meinungen in Sekunden und sieh, wie die Community tickt.</p>
                    </div>
                </div>
                <div class="user-menu">
                    <button class="theme-toggle" id="themeToggle" type="button" aria-label="Theme wechseln" title="Dark/Light Mode">
                        <span class="theme-icon">üåô</span>
                    </button>
                    <button class="feature-btn" type="button" onclick="loadTrending()" title="Trending">
                        <span>üî•</span>
                    </button>
                    <button class="feature-btn" type="button" onclick="loadLeaderboard()" title="Leaderboard">
                        <span>üèÜ</span>
                    </button>
                    <input type="text" id="searchBox" class="search-box" placeholder="Suchen..." style="display: none;">
                    <button class="avatar-button" id="userMenuButton" type="button" aria-expanded="false" aria-haspopup="true">
                        <span id="userAvatar">M</span>
                    </button>
                    <div class="user-dropdown" id="userDropdown" role="menu" aria-hidden="true">
                        <p class="user-name" id="userDisplayName"></p>
                        <button class="dropdown-item" type="button">Account</button>
                        <button class="dropdown-item" id="historyButton" type="button">Historie</button>
                        <button class="dropdown-item logout-item" type="button" onclick="logout()">Logout</button>
                    </div>
                </div>
            </header>

            <section class="gallery" id="opinionGallery">
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
            </section>
        </div>

        <!-- Passwort vergessen Modal -->
        <div id="forgotPasswordModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeForgotPasswordModal()">&times;</span>
                <h2>Passwort zur√ºcksetzen</h2>
                
                <!-- Step 1: Email eingeben -->
                <div id="forgotStep1" class="forgot-step active">
                    <p>Geben Sie Ihre Email-Adresse ein, um einen Reset-Link zu erhalten.</p>
                    <div class="form-group">
                        <label for="forgotEmail">Email:</label>
                        <input type="email" id="forgotEmail" required>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="sendResetToken()">Reset-Link anfordern</button>
                    <div id="forgotMessage1" class="message"></div>
                </div>

                <!-- Step 2: Neues Passwort setzen -->
                <div id="forgotStep2" class="forgot-step">
                    <p>Geben Sie Ihr neues Passwort ein.</p>
                    <div class="form-group">
                        <label for="resetToken">Reset-Token:</label>
                        <input type="text" id="resetToken" placeholder="Token eingeben" required readonly>
                        <small style="color: #999; margin-top: 5px; display: block;">Token wird angezeigt, nachdem Sie den Link angefordert haben</small>
                    </div>
                    <div class="form-group">
                        <label for="resetNewPassword">Neues Passwort:</label>
                        <input type="password" id="resetNewPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="resetConfirmPassword">Passwort wiederholen:</label>
                        <input type="password" id="resetConfirmPassword" required>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="confirmResetPassword()">Passwort zur√ºcksetzen</button>
                    <button type="button" class="btn btn-secondary" onclick="goBackToEmailReset()">Zur√ºck</button>
                    <div id="forgotMessage2" class="message"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Opinion Modal -->
    <div id="newOpinionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeNewOpinionModal()">&times;</span>
            <h2>Neue Meinung erstellen</h2>
            <div class="form-group">
                <label for="opinionText">Text (max. 256 Zeichen):</label>
                <textarea id="opinionText" maxlength="256" rows="4"></textarea>
                <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px;">
                    <button class="btn btn-secondary" onclick="closeNewOpinionModal()">Abbrechen</button>
                    <span id="opinionCharCount">0 / 256</span>
                </div>
            </div>
            <div style="margin-top:12px; text-align:right;">
                <button class="btn btn-primary" id="sendOpinionButton" onclick="sendOpinion()">Senden</button>
            </div>
            <div id="opinionMessage" class="message" style="margin-top:8px;"></div>
        </div>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="modal">
        <div class="modal-content history-content">
            <span class="close" onclick="closeHistoryModal()">&times;</span>
            <h2>Meine Meinungen</h2>
            <div id="historyList">
                <p class="no-data">Keine Eintr√§ge.</p>
            </div>
        </div>
    </div>

    <!-- Facebook SDK -->
    <div id="fb-root"></div>
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/de_DE/sdk.js#xfbml=1&version=v18.0" nonce="abc123"></script>

    <script src="script.js"></script>
</body>
</html>
